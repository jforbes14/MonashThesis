\appendix

# Socio-demographic variables for each electorate {#a:describeSD}

The socio-demographic variables obtained from the Census are defined as follow.

**Age**

`Age0004`: Percentage of population aged 0-4 years

`Age0514`: Percentage of population aged 5-14 years

`Age1519`: Percentage of population aged 15-19 years

`Age2024`: Percentage of population aged 20-24 years

`Age2534`: Percentage of population aged 25-34 years

`Age3544`: Percentage of population aged 35-44 years

`Age4554`: Percentage of population aged 45-54 years

`Age5564`: Percentage of population aged 55-64 years

`Age6574`: Percentage of population aged 65-74 years

`Age7584`: Percentage of population aged 75-84 years

`Age85plus`: Percentage of population aged 85+ years

**Median Statistics**

`MedianPersonalIncome`: Median weekly personal income

`MedianHouseholdIncome`: Median weekly household income

`MedianFamilyIncome`: Median weekly family income

`MedianAge`: Median age (in years)

`MedianRent`: Median weekly rental payment amount (of those who rent)

`MedianLoanPay`: Median mortgage loan repayment amount (of mortgage payments)

**Religion**

`Christianity`: Percentage of respondents that identified as Christian (excluding overseas visitors)

`Anglican`: Percentage of respondents that identified as Anglican (excluding overseas visitors)

`Catholic`: Percentage of respondents that identified as Catholic (excluding overseas visitors)

`Buddhism`: Percentage of respondents that identified as Buddhist (excluding overseas visitors)

`Islam`: Percentage of respondents that identified as Muslim (excluding overseas visitors)

`Judaism`: Percentage of respondents that identified as Jewish (excluding overseas visitors)

`NoReligion`: Percentage of respondents that identified as "no religion", "atheist" etc. (excluding overseas visitors)

`OtherChrist`: Percentage of respondents that identified as Christian, but not Anglican or Catholic (excluding overseas visitors)

**Language, Heritage, Birthplace and Citizenship**

`Indigenous`: Percentage of population that identify as Indigenous or Torres Strait Islander

`AusCitizen`: Percentage of population who are Australian Citizens

`BornAsia`: Percentage of respondents born in Asia (includes: Bangladesh, Cambodia, China, Hong Kong, Indonesia, Japan, South Korea, Malaysia, Nepal, Pakistan, Phillipines, Singapore, Sri Lanka, Thailand, Taiwan, Vietnam)

`BornMidEast`: Percentage of respondents born in Middle East (includes: Afghanistan, Egypt, Iran, Lebanon, Turkey)

`BornSEEurope`: Percentage of respondents born in South-East Europe (includes: Bosnia and Herzegovina, Croatia, Greece, Macedonia, other South-East Europe)

`BornUK`: Percentage of respondents born in the United Kingdom (includes: England, Wales, Scotland, Northern Ireland)

`BornElsewhere`: Percentage of respondents born overseas in regions over Asia, Middle East, South-East Europe and UK  (includes overseas visitors)

`OtherLanguageHome`: Percentage of respondents that speak other languages other than English at home

**Education**

`CurrentlyStudying`: Percentage of population that are currently studying

`HighSchool`: Percentage of respondents (15 years and over) that have finished High School

`Bachelor`: Percentage of respondents (15 years and over) that have completed a Bachelors degree

`Postgraduate`: Percentage of respondents (15 years and over) that have completed a Postgraduate degree

`DipCert`: Percentage of respondents (15 years and over) that have completed a diploma or certificate

Note: respondents is calculated by taking population 15 years and over, less question non-responses

**Employment**

`Unemployed`: Unemployment rate (percentage)

`LFParticipation`: Labour force participation rate (percentage)

`Volunteer`: Percentage of respondents (15 years and over) that do volunteer work [2006, 2011, 2016]

**Industry of Employment**

`ExtractiveJobs`: Percentage of employed persons (respondents) who work in agriculture, mining, electricity, gas, water or waste

`Transformative`: Percentage of employed persons (respondents) who work in construction or manufacturing

`Distributive`: Percentage of employed persons (respondents) who work in wholesale trade, retail trade, transport, post or warehousing

`Finance`: Percentage of employed persons (respondents) who work in finance or insurance

`SocialServ`: Percentage of employed persons (respondents) who work in education and training, healthcare, social work, community, arts and recreation

**Occupation Groups**

`AdminJobs`: Percentage of employed persons (respondents) who work in management, administration, clerical duties and sales

`Professional`: Percentage of employed persons (respondents) who work as a professional

`Tradesperson`: Percentage of employed persons (respondents) who specialise in a trade

`Laborer`: Percentage of employed persons (respondents) who work as a laborer

**Family and Relationship**

`Married`: Percentage of people that are married (excluding overseas visitors, including not stated)

`DeFacto`: Percentage of people that are in a De Facto relationship (excluding overseas visitors, including not stated)

`FamilyRatio`: Ratio of people in families to the number of total families (ie. average number of people per family)

`CoupleNoChildHouse`: Percentage of households that are made up of an adult couple with no children

`CoupleWChildHouse`: Percentage of households that are made up of an adult couple with children

`OneParentHouse`: Percentage of households that are made up of a single parent with children

`SPHouse`: Percentage of households that are made up of a single person

**Dwelling**

`Owned`: Percentage of dwellings that are owned outright (of respondents)

`Mortgage`: Percentage of dwellings that are on a mortgage (of respondents)

`Renting`: Percentage of dwellings that are being rented (of respondents)

`PublicHousing`: Percentage of dwellings that are owned by the government, and rented out to tenants (of respondents)

`NotOwned`: Percentage of dwellings (respondents only) that are not owned outright or on a mortgage

`DiffAddress`: Percentage of respondents who live at a different address to what they did 5 years prior

**Other**

`Area`: Area of Census division in square kilometers

`Population`: Count of persons in Census division


# Distribution of socio-demographic variables across elections {#a:summary}

As seen in Chapter \@ref(ch:Data), violin plots depict the distribution of a variable as a density plot reflected in the vertical axis. Figures \@ref(fig:violinall1) and \@ref(fig:violinall2) contain violin plots of every socio-demographic variable. Note that these variables have not been standardised.

```{r violinall1, fig.height=10, fig.cap = "Distribution of each socio-demographic variable across elections (part 1)."}
# Unscaled violin plots go here
 violins <- profiles %>% 
  select(-c(Election_Division, Swing, Perc_LNP, PartyAb))

violins %>% 
  select(unlist((violins %>% names)[order(violins %>% names)][1:36]), year) %>%
  gather(key = "metric", value = "value", -year) %>%
  ggplot(aes(x=year, y=value)) +
  geom_violin(aes(fill = year)) + 
  facet_wrap(~metric, scales = "free_y", ncol = 4) +
  theme(axis.text.y = element_text(size = 6), axis.text.x = element_text(angle = 90, hjust = 0.5, size = 6), 
        strip.text = element_text(size=6), aspect.ratio = 0.5) +
  guides(fill = FALSE) +
  labs(x = "", y = "")
```

```{r violinall2, fig.height=10, fig.cap = "Distribution of each socio-demographic variable across elections (part 2)."}
# Unscaled violin 2 plots go here
violins %>% 
  select(unlist((violins %>% names)[order(violins %>% names)][37:64])) %>%
  gather(key = "metric", value = "value", -year) %>%
  ggplot(aes(x=year, y=value)) +
  geom_violin(aes(fill = year)) + 
  facet_wrap(~metric, scales = "free_y", ncol = 4) +
  theme(axis.text.y = element_text(size = 6), axis.text.x = element_text(angle = 90, hjust = 0.5, size = 6), 
        strip.text = element_text(size=6), aspect.ratio = 0.5) +
  guides(fill = FALSE) +
  labs(x = "", y = "")
```




```{r scex, fig.cap = "Distribution of unscaled variables (including factors) excluded from the models.", include = FALSE}
# Standardized violin plots go here
data_mod %>% 
  select(-c((superset$varname %>% unlist), Election_Division, Swing, Perc_LNP)) %>% 
  gather(key = "metric", value = "value", -year) %>% 
  ggplot(aes(x=year, y=value)) +
  geom_violin(aes(fill = year)) + 
  facet_wrap(~metric, scales = "free", ncol = 6) +
  theme(axis.text.y = element_text(size = 6), axis.text.x = element_text(angle = 90, hjust = 0.5, size = 6), axis.title = element_text(size = 6), strip.text = element_text(size=5)) +
  guides(fill = FALSE) +
  labs(x = "", y = "")
```




# Principal components {#a:PCloadings}

The variable loadings in the first principal component are relatively common across years (see Figure \@ref(fig:loadings-1) in Chapter \@ref(ch:Modelling)). The same is true for the second component, and to a lesser extent the third and four components (see Figures \@ref(fig:loadings2), \@ref(fig:loadings3) and \@ref(fig:loadings4) below). 

```{r loadings2, fig.cap = "Loadings of each variable in the second principal of each election year (points), with a line showing the range across years."}
vis_loadings %>% 
  ggplot(aes(x=reorder(metric,-PC2), y=PC2)) + geom_line(col = "orange", size = 2, alpha = 0.7) +
  geom_point(size = 1, alpha = 1) + 
  theme(axis.text.x = element_text(angle = 60, hjust=1, size = 6)) +
  labs(x = "Socio-demographic variable", y = "Loading in first principal component")

```

```{r loadings3, fig.cap = "Loadings of each variable in the third principal of each election year (points), with a line showing the range across years."}
vis_loadings %>% 
  ggplot(aes(x=reorder(metric,-PC3), y=PC3)) + geom_line(col = "purple", size = 2, alpha = 0.4) +
  geom_point(size = 1, alpha = 1) + 
  theme(axis.text.x = element_text(angle = 60, hjust=1, size = 6)) +
  labs(x = "Socio-demographic variable", y = "Loading in first principal component")
```

```{r loadings4, fig.cap = "Loadings of each variable in the fourth principal of each election year (points), with a line showing the range across years."}
vis_loadings %>% 
  ggplot(aes(x=reorder(metric,-PC4), y=PC4)) + geom_line(col = "dark green", size = 2, alpha = 0.5) +
  geom_point(size = 1, alpha = 1) + 
  theme(axis.text.x = element_text(angle = 60, hjust=1, size = 6)) +
  labs(x = "Socio-demographic variable", y = "Loading in first principal component")
```


# Why choose all five variable linear models? {#a:fivevar}

For each election, a model set containing all possible five variable linear models is constructed, from which Akaike weights are computed. *Five* variable models are a compromise between computational burden and capturing sufficient information. 

It is too burdensome to run linear models for all possible combinations of the $p=30$ predictors. Instead an iterative procedure is employed to sample from the possible linear models, of all sizes. This is done to see where the incremental gain in R-squared from adding a variable hits a plateau. 

This iterative procedure involves collecting 20 models for each possible number of predictors $p$ in $p = 3, 4, ..., 30$. This means 20 models with 3 variables, 20 models with 4 variables and so on. The process is as follows:

1. Fit all possible 2 variable models.

2. Retain the 10 models with highest R-squared, and another 10 models selected at random.

3. Fit all possible three variable models that nest these 20 two-variable models, by adding one variable. (This means for every retained two variable model, there will be $28$ models fit.)

4. Repeat steps 2 and 3 for the threevariable models, four variable models, and so on, until reaching a model with all 30 variables.

Figure \@ref(fig:tradeoff) shows the R-squared for each of the models retained against the number of predictors used. The line represents the maximum R-squared each number of predictors. Around 70% of variation in two-party preference can be explained by a five variable model in each election, and the full variable set explains around 80% of variation (i.e. R-squared of 0.8). From four variables onwards, there is little incremental gain in R-squared from adding another variable.

All possible $p$ variable models for each election involves fitting ${30 \choose p} \times 6$ models. The computational burden here becomes huge very quickly. For this reason, we have chosen $p=5$ variable models, as it is computationally feasible and includes models that have large R-squared.

```{r tradeoff, fig.cap = "R-squared for each model, with the number of variables included on the x-axis."}
load("../Modelling-Elections/Clean-Data/step_all.rda")

ggplot(aes(x = num_vars, y = r2), data = step_all) + 
  geom_point(alpha = 0.3) +
  geom_line(data = step_all %>% filter(max_r2 == 1)) +
  facet_wrap(~year) +
  labs(x = "Number of variables", y = "R-squared")
```

# Resultant Akaike weights {#a:allSAW}

The sum of Akaike weights $s_j$ for each variable $j$ in each of the elections are shown in the Table E.1 below.

```{r allSAW, fig.cap = "Sum of Akaike weights for each variable, in each election.", results = 'asis'}
load("../Modelling-Elections/Clean-Data/var_imp_all.rda")

tab_aw <- var_imp_all %>% 
  mutate(varname = gsub("_", "", varname),
         varname = ifelse(varname == "ManagerAdminClericalSales", "AdminJobs", varname),
         varname = ifelse(varname == "Extractive", "ExtractiveJobs", varname),
         varname = ifelse(varname == "Educ", "Education", varname)) %>% 
  select(varname, year, sum_w) %>% 
  spread("year", "sum_w") %>% 
  rename(Variable = varname) %>% 
  xtable::xtable(caption = "Sum of Akaike weights for each variable, in each election.")

print(tab_aw, comment = FALSE, include.rownames = FALSE, size = "\\footnotesize")
```


# Summary of socio-demographics in the superset {#a:summarySS}

Violin plots are used in place of summary statistics to describe the distribution of each socio-demographic predictor, along with the two-party preferred vote, in each of the election years.

```{r sumSS, fig.cap="Violin plots of each socio-demographic variable, in each election. This provides an illustration of the distribution of each variable."}
data_mod %>% 
  select(c(superset$varname), year) %>% 
  gather("key", "value", -year) %>% 
  ggplot(aes(x = year, y = value)) +
  geom_violin(aes(fill = year)) +
  facet_wrap(~key) +
  coord_fixed(ratio = 0.3) +
  theme(axis.text.x = element_text(size = 8, angle = 75, vjust = 0.5), 
        axis.text.y = element_text(size=8), axis.title = element_text(size = 10)) + 
  guides(fill = FALSE) +
  labs(x = "Election year", y = "Value of centered and standardized\nsocio-demographic variable")
```
```{r TPPviolin, out.width='50%', fig.cap="Violin plots illustrating the distribution of the two-party preferred vote across election years."}
data_mod %>% 
  ggplot(aes(x = year, y = Perc_LNP)) + 
  geom_violin(aes(fill = year)) +
  labs(x = "Election year", y = "Two-party preferred vote (%)") +
  theme(axis.text.x = element_text(size = 14, angle = 75, vjust = 0.5), 
        axis.text.y = element_text(size=14), axis.title = element_text(size = 18)) + coord_fixed(0.05) + guides(fill = FALSE)
```



# Scatterplots of two-party preferred against predictors in the superset {#a:scatterplots}

Scatterplots of each variable across election years are shown in the plots below. A regression line is overlaid in each plot with a 95% confidence band.

```{r rawSE, fig.cap="Scatterplot of population born in South-Eastern Europe against two-party preferred vote."}
## Voting against BornSEEurope
data_mod %>% ggplot(aes(x = BornSEEurope, y = Perc_LNP)) + geom_point() + geom_smooth(method = "lm") + facet_wrap(~year) + labs(x = "BornSEEurope: Population born in South-Eastern Europe", y = "Two-party preferred (%)")
```

```{r rawUK, fig.cap="Scatterplot of population born in the United Kingdom against two-party preferred vote."}
## Voting against BornUK
data_mod %>% ggplot(aes(x = BornUK, y = Perc_LNP)) + geom_point(aes(label = Election_Division)) + geom_smooth(method = "lm") + facet_wrap(~year) + labs(x = "BornUK: Population born in the United Kingdom", y = "Two-party preferred (%)")
```

```{r rawNoRelig, fig.cap="Scatterplot of population not identifying with a religion against two-party preferred vote."}
## Voting against NoReligion
data_mod %>% ggplot(aes(x = NoReligion, y = Perc_LNP)) + geom_point(aes(label = Election_Division)) + geom_smooth(method = "lm") + facet_wrap(~year) + labs(x = "NoReligion: Proportion of population not identifying with a religion", y = "Two-party preferred (%)")
```

```{r rawrentloan, fig.cap="Scatterplot of rental and loan payments against two-party preferred vote."}
## Voting against RentLoan
data_mod %>% ggplot(aes(x = RentLoan, y = Perc_LNP)) + geom_point(aes(label = Election_Division)) + geom_smooth(method = "lm") + facet_wrap(~year) + labs(x = "RentLoan: Rental and loan payments", y = "Two-party preferred (%)")
```

```{r raweduc, fig.cap="Scatterplot of education levels against two-party preferred vote."}
## Voting against Education
data_mod %>% ggplot(aes(x = Education, y = Perc_LNP)) + geom_point(aes(label = Election_Division)) + geom_smooth(method = "lm") + facet_wrap(~year) + labs(x = "Education: Education level", y = "Two-party preferred (%)")
```

```{r rawstudy, fig.cap="Scatterplot of population currently studying against two-party preferred vote."}
## Voting against Currently studying
data_mod %>% ggplot(aes(x = CurrentlyStudying, y = Perc_LNP)) + geom_point(aes(label = Election_Division)) + geom_smooth(method = "lm") + facet_wrap(~year) + labs(x = "CurrentlyStudying: Proportion of population currently studying", y = "Two-party preferred (%)")
```

```{r rawage, fig.cap="Scatterplot of median age against two-party preferred vote."}
## Voting against MedianAge
data_mod %>% ggplot(aes(x = MedianAge, y = Perc_LNP)) + geom_point(aes(label = Election_Division)) + geom_smooth(method = "lm") + facet_wrap(~year) + labs(x = "MedianAge: Median age", y = "Two-party preferred (%)")
```

```{r rawOP, fig.cap = "Scatterplot of single parent households against two-party preferred vote."}
## Voting against OneParentHouse
data_mod %>% ggplot(aes(x = OneParentHouse, y = Perc_LNP)) + geom_point(aes(label = Election_Division)) + geom_smooth(method = "lm") + facet_wrap(~year) + labs(x = "OneParentHouse: Proportion of single parent households", y = "Two-party preferred (%)")
```

```{r rawext, fig.cap="Scatterplot of population working in ExtractiveJobs jobs against two-party preferred vote."}
## Voting against ExtractiveJobs
data_mod %>% ggplot(aes(x = ExtractiveJobs, y = Perc_LNP)) + geom_point(aes(label = Election_Division)) + geom_smooth(method = "lm") + facet_wrap(~year) + labs(x = "ExtractiveJobs: Proportion of jobs in extractive industries", y = "Two-party preferred (%)")
```

```{r rawadmin, fig.cap="Scatterplot of population working in administrative jobs against two-party preferred vote."}
## Voting against AdminJobs
data_mod %>% ggplot(aes(x = AdminJobs, y = Perc_LNP)) + geom_point(aes(label = Election_Division)) + geom_smooth(method = "lm") + facet_wrap(~year) + labs(x = "Adminjobs: Proportion of jobs in administrative jobs", y = "Two-party preferred (%)")
```



# Diagnostics {#a:diagnostics}

In this section, regression diagnostics are conducted to test the assumptions involved in linear regression. Residual heteroskedasticity and non-normality are tested in \@ref(a:resids). Tests for non-linear patterns in the residuals against included predictors are in \@ref(a:patternsin), and patterns in the residuals against missing predictors are contained in \@ref(a:patternsout). Tests for influential points are found in \@ref(a:influence).

## Residuals {#a:resids}

```{r augment}
aug_all <- bind_rows(augment(fit_ss_01) %>% mutate(year = "2001"), 
                     augment(fit_ss_04) %>% mutate(year = "2004"), 
                     augment(fit_ss_07) %>% mutate(year = "2007"), 
                     augment(fit_ss_10) %>% mutate(year = "2010"), 
                     augment(fit_ss_13) %>% mutate(year = "2013"), 
                     augment(fit_ss_16) %>% mutate(year = "2016"))
```

There is little evidence of residual non-normality in the histograms (Figure \@ref(fig:histograms)) and quantile-quantile plots (Figure \@ref(fig:QQplots)), nor are there signs of residual heteroskedasticity (Figure \@ref(fig:reshet)).

```{r histograms, fig.cap="Residual histogram for each election. Residual distributions do not appear to be too dissimilar from a normal distribution."}
# Histogram
aug_all %>% 
  ggplot(aes(x = .resid)) + 
  geom_histogram() +
  facet_wrap(~year, nrow = 2) + 
  labs(x = "Residuals", y = "Count") +
  theme(axis.title = element_text(size = 10), title = element_text(size = 10),
        plot.margin=unit(c(0.2,0.2,0.2,0.2), "cm")) + coord_fixed(ratio = 0.75)
```

```{r QQplots, fig.cap="Quantiles of the residuals in each election against the quantiles of a normal distribution. Residual quantiles closely match the normal quantiles in each election."}
# QQ plots
aug_all %>% 
  ggplot(aes(sample = .resid)) + 
  geom_qq(alpha = 0.4) + geom_qq_line() + 
  facet_wrap(~year, nrow = 2) +
  labs(x = "Theoretical quantiles", y = "Sample residual quantiles") +
  theme(axis.title = element_text(size = 10), title = element_text(size = 10),
        plot.margin=unit(c(0.2,0.2,0.2,0.2), "cm")) + coord_fixed(ratio = 0.1)
```


```{r reshet, fig.cap="Residuals vs. fitted values of the response variable for each election. No signs of heteroskedasticity are seen."}
# Residuals vs fitted
aug_all %>% 
  ggplot(aes(x=.fitted, y=.resid)) + 
  geom_point() +
  facet_wrap(~year, nrow = 2) + 
  labs(x = "Fitted values", y = "Residuals") +
  theme(axis.title = element_text(size = 10), title = element_text(size = 10),
        plot.margin=unit(c(0.2,0.2,0.2,0.2), "cm")) + coord_fixed(ratio = 0.75)
```

## Residuals vs predictors in the model {#a:patternsin}

Tests for non-linear relationships between the predictors in the model and the residuals are conducted by fitting a loess smooth to the scatterplot with a 95% confidence band. If zero is contained in the confidence band for all values of the predictor, then is insufficient evidence of a significant non-linearity. No obvious non-linearities are found in any election. Plots for 2016 are shown in Figure \@ref(fig:resvpred).

```{r resvpred, out.width='90%', fig.cap = "Residuals vs. predictors in the 2016 election model. No obvious signs of non-linearity."}
aug_all %>%
  filter(year == "2016") %>% 
  gather(key = "variable", value = "value", -c(starts_with("."), Perc_LNP, year)) %>% 
  ggplot(aes(x = value, y = .resid)) +
  geom_point(size = 0.5) + geom_smooth() + facet_wrap(~variable, nrow = 3) + coord_fixed(.1) +
  labs(x = "Socio-demographic variable", y = "Residuals") +
  theme(plot.margin=unit(c(0.2,0.2,0.2,0.2), "cm"), axis.text = element_text(size = 8))
```

## Residuals vs predictors not in model {#a:patternsout}

Scatterplots of the residuals against socio-demographic predictors are produced with a loess smooth fit and overlaid in each plot. No significant relationships are found between the residuals and predictors not in the superset, in any of the election.

## Influence {#a:influence}

Across the six elections, only two electorates have moderately large influence - Kalgoorlie (2001, 2004) and Sydney (2007, 2016) - as they have a cook's distance greater than 0.2 (0.31, 0.22, 0.22 and 0.27 respectively). The Kalgoorlie electorate supports the Liberal party in these years ($TPP$ of around 55%), but has an extremely low incidence of administrative jobs (which is tied to strong Labor support). Sydney is a staunch Labor electorate, with $TPP$ ranging from 30.50% to 35.35% across the six years, whilst having very large student populations and a low incidence of single parent households. All of the observations with moderately large influence have hat values over 0.3, indicating that these also have unusual socio-demographic compositions.

The most influential electorate is Kalgoorlie in 2001, with cook distance of 0.31. Using a threshold of 0.5, no outliers outliers appear in any of the elections, and therefore no observations need to be removed. 

# Omitted variables {#a:omittedvar}

There are twenty socio-demographic predictors that are not in the superset, and some of these may seem releveant and useful to include in a model. However, most of the variation in many of the left out variables can be explained by predictors included in the model. To determine the percentage of variation explained, the R-squared is recorded from a regression of each left out predictor on the superset of explanatory variables in the model (including interactions). Figure \@ref(fig:ovb) shows these R-squared values, for each left out predictor, in each election.

For example, over 85% of the variation in the `Incomes` variable and over 75% of the variation in the variable `LFParticipation`, is actually explained by the superset of variables. Other variables, for example `Judaism`, are not well explained by the superset, but are also not influential in determining two-party preference which justifies their exclusion from the final model.

```{r ovb, fig.cap = "R-squared of each omitted variable when regressed on the superset each year."}
OVB_fn <- function(Year) {
  Year <- as.character(Year)
  
OVB_lm <- data.frame(varname = names(data_mod), r2 = 0, adj_r2 = 0) %>% 
  filter(!varname %in% c("Election_Division", "Perc_LNP", "Swing", "year", superset$varname %>% unlist %>% as.character))

for (i in 1:nrow(OVB_lm)) {
  varname = OVB_lm$varname[i] %>% as.character()
  data_ovb = data_mod %>% filter(year == Year, !is.na(Perc_LNP)) %>% select(c(superset$varname %>% as.character), varname)
  formula_ovb = paste0(varname, " ~ .")
  lmod = lm(formula = formula_ovb,
            data = data_ovb)
  OVB_lm$r2[i] = summary(lmod)$r.squared
  OVB_lm$adj_r2[i] = summary(lmod)$adj.r.squared
}

OVB_lm <- OVB_lm %>% mutate(year = Year)

return(OVB_lm)
}

OVB_all <- bind_rows(OVB_fn(2001), OVB_fn(2004), OVB_fn(2007), OVB_fn(2010), OVB_fn(2013), OVB_fn(2016)) %>% 
  select(-adj_r2)

OVB_all %>% 
  ggplot(aes(x=r2, y = reorder(varname, r2))) + 
  geom_point(aes(col = year), size = 2) +
  labs(x = "R-squared", y = "Omitted Variable", colour = "Election year") 

# Order by average in each row
# Discuss those above 75%
# Others:

# Argue - avoided OVB by construction
# Then discuss why some variables are omitted
```


# Interpretation of additional socio-demographic variables {#a:extrainsights}

This section contains the partial residual plots and 2D heatmaps that were omitted from Chapter \@ref(ch:Insights). See Chapter \@ref(ch:Insights) for a discussion of the insights from these visualizations.

## Migrants from the United Kingdom

The proportion of an electoral population born in the United Kingdom, `BornUK`, does not have a significant effect on two-party preference in any of the elections.

```{r UK1, out.width="100%", fig.cap="Partial residual plots for the effect of population born in the United Kingdom, across election years. A linear regression line is overlaid. No significant relationship is observed in any election."}
BornUK_01 <- visreg(fit_ss_01, "BornUK", gg = T,  print.cond = FALSE, fill = list(col = "grey75")) + 
  labs(x = "", y = "", title = "2001") +
  theme_bw() + 
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5)) +
  lims(x = c(-1.8, 5.2), y = c(32,68)) + coord_cartesian(expand = FALSE)
BornUK_04 <- visreg(fit_ss_04, "BornUK", gg = T,  print.cond = FALSE, fill = list(col = "grey75")) + 
  labs(x = "", y = "", title = "2004") +
  theme_bw() + 
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5)) +
  lims(x = c(-1.8, 5.2), y = c(32,68)) + coord_cartesian(expand = FALSE) 
BornUK_07 <- visreg(fit_ss_07, "BornUK", gg = T,  print.cond = FALSE, fill = list(col = "grey75")) + 
  labs(x = "", y = "", title = "2007") +
  theme_bw() + 
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5))  +
  lims(x = c(-1.8, 5.2), y = c(32,68)) + coord_cartesian(expand = FALSE)
BornUK_10 <- visreg(fit_ss_10, "BornUK", gg = T,  print.cond = FALSE, fill = list(col = "grey75")) + 
  labs(x = "", y = "", title = "2010") +
  theme_bw() + 
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5)) +
  lims(x = c(-1.8, 5.2), y = c(32,68)) + coord_cartesian(expand = FALSE) 
BornUK_13 <- visreg(fit_ss_13, "BornUK", gg = T,  print.cond = FALSE, fill = list(col = "grey75")) + 
  labs(x = "", y = "", title = "2013") +
  theme_bw() + 
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5)) +
  lims(x = c(-1.8, 5.2), y = c(32,68)) + coord_cartesian(expand = FALSE) 
BornUK_16 <- visreg(fit_ss_16, "BornUK", gg = T,  print.cond = FALSE, fill = list(col = "grey75")) + 
  labs(x = "", y = "", title = "2016") +
  theme_bw() + 
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5)) +
  lims(x = c(-1.8, 5.2), y = c(32,68)) + coord_cartesian(expand = FALSE) 

grid.arrange(BornUK_01, BornUK_04, BornUK_07, BornUK_10, BornUK_13, BornUK_16, 
             nrow = 2, 
             #top = textGrob("South-Eastern European Influence", gp = gpar(cex = 0.8)), 
             left = textGrob("Two-party preferred vote (%)", gp = gpar(cex = 0.8), rot = 90), 
             bottom = textGrob("Population born in the United Kingdom (relative)", gp = gpar(cex = 0.8)))
```


```{r UK2, out.width='75%', fig.cap="Estimated coefficients for the population born in the United Kingdom, across election years and with 95\\% confidence bands. Only insignificant effects are observed."}
# Coefficients
all_coefs %>% filter(term == "BornUK") %>% 
  ggplot(aes(x=year, y=estimate)) +
  geom_point(size = 3) + geom_linerange(aes(ymin = lower95, ymax = upper95), size = 1.5) + 
  geom_hline(aes(yintercept = 0), alpha = 0.5, size = 1) + 
  lims(y=c(-6.5,2.5)) +
  theme_bw() +
  theme(axis.text.x = element_text(size = 12), axis.text.y = element_text(size = 12), 
        axis.title = element_text(size = 12)) + 
  coord_fixed(0.15) + 
  labs(x = "", y = "Coefficient estimate: BornUK")
```


## Rental and Loan Payments

The factor `RentLoan` combines electoral median rent and loan payments. In the 2010 election, electorates with higher payment amounts were significantly more likely to support the Liberal party, whereas in other elections `RentLoan` did not have a significant effect.

```{r rentloan1, out.width="100%", fig.cap="Partial residual plots for the effect of rental and loan prices, across election years. A linear regression line is overlaid. In 2010, electorates with higher median rental and loan payments were more likely to support the Liberal party."}
RentLoan_01 <- visreg(fit_ss_01, "RentLoan", gg = T,  print.cond = FALSE, fill = list(col = "grey75")) + 
  labs(x = "", y = "", title = "2001") +
  theme_bw() + 
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5)) +
  lims(x = c(-2, 4), y = c(28,74)) + coord_cartesian(expand = FALSE)
RentLoan_04 <- visreg(fit_ss_04, "RentLoan", gg = T,  print.cond = FALSE, fill = list(col = "grey75")) + 
  labs(x = "", y = "", title = "2004") +
  theme_bw() + 
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5)) +
  lims(x = c(-2, 4), y = c(28,74)) + coord_cartesian(expand = FALSE) 
RentLoan_07 <- visreg(fit_ss_07, "RentLoan", gg = T,  print.cond = FALSE, fill = list(col = "grey75")) + 
  labs(x = "", y = "", title = "2007") +
  theme_bw() + 
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5))  +
  lims(x = c(-2, 4), y = c(28,74)) + coord_cartesian(expand = FALSE)
RentLoan_10 <- visreg(fit_ss_10, "RentLoan", gg = T,  print.cond = FALSE, fill = list(col = "grey75")) + 
  labs(x = "", y = "", title = "2010") +
  theme_bw() + 
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5)) +
  lims(x = c(-2, 4), y = c(28,74)) + coord_cartesian(expand = FALSE) 
RentLoan_13 <- visreg(fit_ss_13, "RentLoan", gg = T,  print.cond = FALSE, fill = list(col = "grey75")) + 
  labs(x = "", y = "", title = "2013") +
  theme_bw() + 
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5)) +
  lims(x = c(-2, 4), y = c(28,74)) + coord_cartesian(expand = FALSE) 
RentLoan_16 <- visreg(fit_ss_16, "RentLoan", gg = T,  print.cond = FALSE, fill = list(col = "grey75")) + 
  labs(x = "", y = "", title = "2016") +
  theme_bw() + 
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5)) +
  lims(x = c(-2, 4), y = c(28,74)) + coord_cartesian(expand = FALSE) 

grid.arrange(RentLoan_01, RentLoan_04, RentLoan_07, RentLoan_10, RentLoan_13, RentLoan_16, 
             nrow = 2, 
             #top = textGrob("South-Eastern European Influence", gp = gpar(cex = 0.8)), 
             left = textGrob("Two-party preferred vote (%)", gp = gpar(cex = 0.8), rot = 90), 
             bottom = textGrob("Rent and Loan prices (factor)", gp = gpar(cex = 0.8)))
```

```{r rentloan2, out.width='75%', fig.cap="Estimated coefficients for rental and loan payments across years with 95\\% confidence bands. Only in 2010 is there a significant effect."}

# Coefficients
all_coefs %>% filter(term == "RentLoan") %>% 
  ggplot(aes(x=year, y=estimate)) +
  geom_point(size = 3) + geom_linerange(aes(ymin = lower95, ymax = upper95), size = 1.5) + 
  geom_hline(aes(yintercept = 0), alpha = 0.5, size = 2) + 
  lims(y=c(-8,8)) +
  theme_bw() +
  theme(axis.text.x = element_text(size = 12), axis.text.y = element_text(size = 12), 
        axis.title = element_text(size = 12)) + 
  coord_fixed(0.15) + 
  labs(x = "", y = "Coefficient estimate: RentLoan")
```

## Administrative Jobs and Education

Over all years we see that for moderate-to-high proportions of workers in administrative jobs, low education levels lead to support for the Liberal party. Otherwise, an electorate is predicted to support Labor. This is consistent across elections. See Figure \@ref(fig:admineduc).

```{r admineduc, fig.cap="2D heatmap of combinations of education and median age, in each election year. Colour indicates the predicted two-party preferred vote. Electorates with high education levels and low median age consistently support Labor (bottom-right). Older electorates with low education levels shift to support Liberal from 2007 (top-left)."}

# Partial residuals for each year
dat16 <- data_mod %>% 
  filter(year == "2016") %>% 
  mutate(Education = 0, AdminJobs = 0)
partials16 <- dat16$Perc_LNP - predict(fit_ss_16, dat16)

dat13 <- data_mod %>% 
  filter(year == "2013") %>% 
  mutate(Education = 0, AdminJobs = 0)
partials13 <- dat13$Perc_LNP - predict(fit_ss_13, dat13)

dat10 <- data_mod %>% 
  filter(year == "2010") %>% 
  mutate(Education = 0, AdminJobs = 0)
partials10 <- dat10$Perc_LNP - predict(fit_ss_10, dat10)

dat07 <- data_mod %>% 
  filter(year == "2007") %>% 
  mutate(Education = 0, AdminJobs = 0)
partials07 <- dat07$Perc_LNP - predict(fit_ss_07, dat07)

dat04 <- data_mod %>% 
  filter(year == "2004") %>% 
  mutate(Education = 0, AdminJobs = 0)
partials04 <- dat04$Perc_LNP - predict(fit_ss_04, dat04)

dat01 <- data_mod %>% 
  filter(year == "2001", !is.na(Perc_LNP)) %>% 
  mutate(Education = 0, AdminJobs = 0)
partials01 <- dat01$Perc_LNP - predict(fit_ss_01, dat01)


# 2D Heatmap
admineduc_df <- data.frame(
  AdminJobs = rep(seq(-4,4, by = 0.01), times = 801),
  Education = rep(seq(-4,4, by = 0.01), each = 801),
  NoReligion = 0,
  CurrentlyStudying = 0,
  MedianAge = 0,
  OneParentHouse = 0,
  BornUK = 0,
  BornSEEurope = 0,
  ExtractiveJobs = 0,
  RentLoan = 0
)

admineduc_df$z16 = predict(fit_ss_16, admineduc_df) - fit_ss_16$coefficients[1]
admineduc_df$z13 = predict(fit_ss_13, admineduc_df) - fit_ss_13$coefficients[1]
admineduc_df$z10 = predict(fit_ss_10, admineduc_df) - fit_ss_10$coefficients[1]
admineduc_df$z07 = predict(fit_ss_07, admineduc_df) - fit_ss_07$coefficients[1]
admineduc_df$z04 = predict(fit_ss_04, admineduc_df) - fit_ss_04$coefficients[1]
admineduc_df$z01 = predict(fit_ss_01, admineduc_df) - fit_ss_01$coefficients[1]

Admin_Educ_16 <- admineduc_df %>% ggplot(aes(x=Education, y=AdminJobs)) +
  geom_raster(aes(fill = z16)) + 
  labs(x = "", y = "", fill = "Marginal effect on two-party preferred (%)", title = "2016") +
  theme_bw() + 
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5),
        plot.margin=unit(c(0.2,-1.5,-0.5,-1.5), "cm")) + 
  scale_fill_gradientn(colours = c("#ff0000", "#ff6666", "#ff9999", "#ffcccc", "white", "#cce6ff", "#3399ff", "#3385ff", "#3366ff"), 
                       values = scales::rescale(c(min(admineduc_df$z16), -12, -6, -3, 
                                                  0, 3, 6, 12, max(admineduc_df$z16)))) +  
  geom_point(aes(x=Education,y=AdminJobs, col=partials16), alpha = 0.7, data = data_mod %>% filter(year == "2016"), size = 0.8) +  
  geom_point(aes(x=Education,y=AdminJobs), shape = 1, data = data_mod %>% filter(year == "2016"), alpha = 0.2, size = 0.8) +  
  scale_color_gradientn(colours = c("#ff0000", "#ff6666", "#ff9999", "#ffcccc", "white", "#cce6ff", "#3399ff", "#3385ff", "#3366ff"), 
                       values = scales::rescale(c(min(partials16), -8, -4, -2, 
                                                  0, 2, 4, 8, max(partials16)))) +  
  guides(fill = FALSE, col = FALSE) +
  lims(x = c(-1.5,3.3), y = c(-2.8, 3.0)) + coord_fixed(expand=FALSE, ratio = 2/3)

Admin_Educ_13 <- admineduc_df %>% ggplot(aes(x=Education, y=AdminJobs)) +
  geom_raster(aes(fill = z13)) + 
  labs(x = "", y = "", fill = "Marginal effect on two-party preferred (%)", title = "2013") +
  theme_bw() + 
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5),
        plot.margin=unit(c(0.2,-1.5,-0.5,-1.5), "cm")) + 
  scale_fill_gradientn(colours = c("#ff0000", "#ff6666", "#ff9999", "#ffcccc", "white", "#cce6ff", "#3399ff", "#3385ff", "#3366ff"), 
                       values = scales::rescale(c(min(admineduc_df$z13), -12, -6, -3, 
                                                  0, 3, 6, 12, max(admineduc_df$z13)))) +  
  geom_point(aes(x=Education,y=AdminJobs,col=partials13), alpha = 0.7, data = data_mod %>% filter(year == "2013"), size = 0.8) + 
  geom_point(aes(x=Education,y=AdminJobs), shape = 1, alpha = 0.2, data = data_mod %>% filter(year == "2013"), size = 0.8) +  
  scale_color_gradientn(colours = c("#ff0000", "#ff6666", "#ff9999", "#ffcccc", "white", "#cce6ff", "#3399ff", "#3385ff", "#3366ff"), 
                       values = scales::rescale(c(min(partials13), -8, -4, -2, 
                                                  0, 2, 4, 8, max(partials13)))) +  
  guides(fill = FALSE, col = FALSE) +
  lims(x = c(-1.5,3.3), y = c(-2.8, 3.0)) + coord_fixed(expand=FALSE, ratio = 2/3)

Admin_Educ_10 <- admineduc_df %>% ggplot(aes(x=Education, y=AdminJobs)) +
  geom_raster(aes(fill = z10)) + 
  labs(x = "", y = "", fill = "Marginal effect on two-party preferred (%)", title = "2010") +
  theme_bw() + 
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5),
        plot.margin=unit(c(0.2,-1.5,-0.5,-1.5), "cm")) + 
  scale_fill_gradientn(colours = c("#ff0000", "#ff6666", "#ff9999", "#ffcccc", "white", "#cce6ff", "#3399ff", "#3385ff", "#3366ff"), 
                       values = scales::rescale(c(min(admineduc_df$z10), -12, -6, -3, 
                                                  0, 3, 6, 12, max(admineduc_df$z10)))) +  
  geom_point(aes(x=Education,y=AdminJobs, col=partials10), alpha = 0.7, data = data_mod %>% filter(year == "2010"), size = 0.8) +  
  geom_point(aes(x=Education,y=AdminJobs), shape = 1, alpha = 0.2,  data = data_mod %>% filter(year == "2010"), size = 0.8) +  
  scale_color_gradientn(colours = c("#ff0000", "#ff6666", "#ff9999", "#ffcccc", "white", "#cce6ff", "#3399ff", "#3385ff", "#3366ff"), 
                       values = scales::rescale(c(min(partials10), -8, -4, -2, 
                                                  0, 2, 4, 8, max(partials10)))) +  
  guides(fill = FALSE, col = FALSE) +
  lims(x = c(-1.5,3.3), y = c(-2.8, 3.0)) + coord_fixed(expand=FALSE, ratio = 2/3)

Admin_Educ_07 <- admineduc_df %>% ggplot(aes(x=Education, y=AdminJobs)) +
  geom_raster(aes(fill = z07)) + 
  labs(x = "", y = "", fill = "Marginal effect on two-party preferred (%)", title = "2007") +
  theme_bw() + 
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5),
        plot.margin=unit(c(0.2,-1.5,-0.5,-1.5), "cm")) +  
  scale_fill_gradientn(colours = c("#ff0000", "#ff6666", "#ff9999", "#ffcccc", "white", "#cce6ff", "#3399ff", "#3385ff", "#3366ff"), 
                       values = scales::rescale(c(min(admineduc_df$z07), -12, -6, -3, 
                                                  0, 3, 6, 12, max(admineduc_df$z07)))) +  
  geom_point(aes(x=Education,y=AdminJobs, col=partials07), alpha = 0.7, data = data_mod %>% filter(year == "2007"), size = 0.8) +  
  geom_point(aes(x=Education,y=AdminJobs), shape = 1, alpha = 0.2, data = data_mod %>% filter(year == "2007"), size = 0.8) +  
  scale_color_gradientn(colours = c("#ff0000", "#ff6666", "#ff9999", "#ffcccc", "white", "#cce6ff", "#3399ff", "#3385ff", "#3366ff"), 
                       values = scales::rescale(c(min(partials07), -8, -4, -2, 
                                                  0, 2, 4, 8, max(partials07)))) +  
  guides(fill = FALSE, col = FALSE) +
  lims(x = c(-1.5,3.3), y = c(-2.8, 3.0)) + coord_fixed(expand=FALSE, ratio = 2/3)

Admin_Educ_04 <- admineduc_df %>% ggplot(aes(x=Education, y=AdminJobs)) +
  geom_raster(aes(fill = z04)) + 
  labs(x = "", y = "", fill = "Marginal effect on two-party preferred (%)", title = "2004") +
  theme_bw() + 
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5),
        plot.margin=unit(c(0.2,-1.5,-0.5,-1.5), "cm")) + 
  scale_fill_gradientn(colours = c("#ff0000", "#ff6666", "#ff9999", "#ffcccc", "white", "#cce6ff", "#3399ff", "#3385ff", "#3366ff"), 
                       values = scales::rescale(c(min(admineduc_df$z04), -12, -6, -3, 
                                                  0, 3, 6, 12, max(admineduc_df$z04)))) +  
  geom_point(aes(x=Education,y=AdminJobs, col=partials04), alpha = 0.7, data = data_mod %>% filter(year == "2004"), size = 0.8) + 
  geom_point(aes(x=Education,y=AdminJobs), shape = 1, alpha = 0.2, data = data_mod %>% filter(year == "2004"), size = 0.8) + 
  scale_color_gradientn(colours = c("#ff0000", "#ff6666", "#ff9999", "#ffcccc", "white", "#cce6ff", "#3399ff", "#3385ff", "#3366ff"), 
                       values = scales::rescale(c(min(partials04), -8, -4, -2, 
                                                  0, 2, 4, 8, max(partials04)))) +  
  guides(fill = FALSE, col = FALSE) +
  lims(x = c(-1.5,3.3), y = c(-2.8, 3.0)) + coord_fixed(expand=FALSE, ratio = 2/3)

Admin_Educ_01 <- admineduc_df %>% ggplot(aes(x=Education, y=AdminJobs)) +
  geom_raster(aes(fill = z01)) + 
  labs(x = "", y = "", fill = "Marginal effect on two-party preferred (%)", title = "2001") +
  theme_bw() + 
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5),
        plot.margin=unit(c(0.2,-1.5,-0.5,-1.5), "cm")) + 
  scale_fill_gradientn(colours = c("#ff0000", "#ff6666", "#ff9999", "#ffcccc", "white", "#cce6ff", "#3399ff", "#3385ff", "#3366ff"), 
                       values = scales::rescale(c(min(admineduc_df$z01), -12, -6, -3, 
                                                  0, 3, 6, 12, max(admineduc_df$z01)))) +  
  geom_point(aes(x=Education,y=AdminJobs, col=partials01), alpha = 0.7, data = data_mod %>% filter(year == "2001", !is.na(Perc_LNP)), size = 0.8) +  
  geom_point(aes(x=Education,y=AdminJobs), alpha = 0.2, shape = 1, data = data_mod %>% filter(year == "2001", !is.na(Perc_LNP)), size = 0.8) +  
  scale_color_gradientn(colours = c("#ff0000", "#ff6666", "#ff9999", "#ffcccc", "white", "#cce6ff", "#3399ff", "#3385ff", "#3366ff"), 
                       values = scales::rescale(c(min(partials01), -8, -4, -2, 
                                                  0, 2, 4, 8, max(partials01)))) +  
  guides(fill = FALSE, col = FALSE) +
  lims(x = c(-1.5,3.3), y = c(-2.8, 3.0)) + coord_fixed(expand=FALSE, ratio = 2/3)

grid.arrange(Admin_Educ_01, Admin_Educ_04, Admin_Educ_07, Admin_Educ_10, Admin_Educ_13, Admin_Educ_16, TPP_scale,
             nrow = 3, 
             widths = c(1,1,1),
             heights = c(0.25, 1, 1),
             layout_matrix = rbind(c(7, 7, 7),
                                   c(1,2,3),
                                   c(4,5,6)),
             bottom = textGrob("Education levels", gp = gpar(cex = 0.8)), 
             left = textGrob("Administrative jobs", gp = gpar(cex = 0.8), rot = 90))
```


