\appendix

# Socio-demographic metrics for each electorate {#a:describeSD}

ID: Commonwealth Electoral Divison (Census division) number

Electorate: Name of Commonwealth Electoral Division

State: State of Census division

Population: Count of persons in Census division

**Age**

Age00_04: Percentage of population aged 0-4 years

Age05_14: Percentage of population aged 5-14 years

Age15_19: Percentage of population aged 15-19 years

Age20_24: Percentage of population aged 20-24 years

Age25_34: Percentage of population aged 25-34 years

Age35_44: Percentage of population aged 35-44 years

Age45_54: Percentage of population aged 45-54 years

Age55_64: Percentage of population aged 55-64 years

Age65_74: Percentage of population aged 65-74 years

Age75_84: Percentage of population aged 75-84 years

Age85plus: Percentage of population aged 85+ years

**Median Statistics**

MedianPersonalIncome: Median weekly personal income

MedianHouseholdIncome: Median weekly household income

MedianFamilyIncome: Median weekly family income

MedianAge: Median age

MedianRent: Median weekly rental payment amount (of those who rent)

MedianLoanPay: Median mortgage loan repayment amount (of mortgage payments)

**Religion**

Christianity: Percentage of respondents that identified as Chrisitan (excluding overseas visitors)

Anglican: Percentage of respondents that identified as Anglican (excluding overseas visitors)

Catholic: Percentage of respondents that identified as Catholic (excluding overseas visitors)

Buddhism: Percentage of respondents that identified as Buddist (excluding overseas visitors)

Islam: Percentage of respondents that identified as Muslim (excluding overseas visitors)

Judaism: Percentage of respondents that identified as Jewish (excluding overseas visitors)

NoReligion: Percentage of respondents that identified as "no religion", "athiest" etc. (excluding overseas visitors)

OtherChrist: Percentage of respondents that identified as Christian, but not Anglican or Catholic (excluding overseas visitors)

**Language, Heritage, Birthplace and Citizenship**

Indigenous: Percentage of population that identify as Indigenous or Torres Strait Islander

AusCitizen: Percentage of population who are Australian Citizens

Born_Asia: Percentage of respondents born in Asia (includes: Bangladesh, Cambodia, China, Hong Kong, Indonesia, Japan, South Korea, Malaysia, Nepal, Pakistan, Phillipines, Singapore, Sri Lanka, Thailand, Taiwan, Vietnam)

Born_MidEast: Percentage of respondents born in Middle East (includes: Afghanistan, Egypt, Iran, Lebanon, Turkey)

Born_SE_Europe: Percentage of respondents born in South-East Europe (includes: Bosnia and Herzegovina, Croatia, Greece, Macedonia, other South-East Europe)

Born_UK: Percentage of respondents born in the United Kingdom (includes: England, Wales, Scotland, Northern Ireland)

BornElsewhere: Percentage of respondents born overseas in regions over Asia, Middle East, South-East Europe and UK  (includes overseas visitors)

OtherLanguageHome: Percentage of respondents that speak other languages other than English at home

**Education**

CurrentlyStudying: Percentage of population that are currently studying

HighSchool: Percentage of respondents (15 years and over) that have finished High School

Bachelor: Percentage of respondents (15 years and over) that have completed a Bachelors degree

Postgraduate: Percentage of respondents (15 years and over) that have completed a Postgraduate degree

DipCert: Percentage of respondents (15 years and over) that have completed a diploma or certificate

Note: respondents is calculated by taking population 15 years and over, less question non-responses

**Employment**

Unemployed: Unemployment rate (percentage)

LFParticipation: Labour force participation rate (percentage)

Volunteer: Percentage of respondents (15 years and over) that do volunteer work [2006, 2011, 2016]

**Industry of Employment**

ExtractiveJobs: Percentage of employed persons (respondents) who work in agriculture, mining, electricity, gas, water or waste

Transformative: Percentage of employed persons (respondents) who work in construction or manufacturing

Distributive: Percentage of employed persons (respondents) who work in wholesale trade, retail trade, transport, post or warehousing

Finance: Percentage of employed persons (respondents) who work in finance or insurance

SocialServ: Percentage of employed persons (respondents) who work in education and training, healthcare, wocial work, community, arts and recreation

**Occupation Groups**

AdminJobs: Percentage of employed persons (respondents) who work in management, administration, clerical Duties and sales

Professional: Percentage of employed persons (respondents) who work as a professional

Tradesperson: Percentage of employed persons (respondents) who specialise in a trade

Laborer: Percentage of employed persons (respondents) who work as a laborer

**Family and Relationship**

Married: Percentage of people that are married (excluding overseas visitors, including not stated)

DeFacto: Percentage of people that are in a De Facto relationship (excluding overseas visitors, including not stated)

FamilyRatio: Ratio of people in families to the number of total families (ie. average number of people per family)

Couple_NoChild_House: Percentage of households that are made up of an adult couple with no children

Couple_WChild_House: Percentage of households that are made up of an adult couple with children

OneParent_House: Percentage of households that are made up of a single parent with children

SP_House: Percentage of households that are made up of a single person

**Dwelling**

Owned: Percentage of dwellings that are owned outright (of respondents)

Mortgage: Percentage of dwellings that are on a mortgage (of respondents)

Renting: Percentage of dwellings that are being rented (of respondents)

PublicHousing: Percentage of dwellings that are owned by the government, and rented out to tenants (of respondents)

NotOwned: Percentage of dwellings (respondents only) that are not owned outright or on a mortgage

DiffAddress: Percentage of respondents who live at a different address to what they did 5 years prior



# Summary of variables in each election {#a:summary}

As seen in section \@ref(ch:Data), violin plots are used to depict the distributions of socio-demographic variables across years. Violin plots depict the distribution as a density plot reflected in the vertical axis. Figures \@ref(fig:violinall1) and \@ref(fig:violinall2) (below) contain violin plots of every socio-demographic variable. Note that these variables have not been standardised.

```{r violinall1, fig.height=10, fig.cap = "Distribution of each socio-demographic variable across elections (part 1)."}
# Unscaled violin plots go here
 violins <- profiles %>% 
  select(-c(Election_Division, Swing, Perc_LNP, PartyAb))

violins %>% 
  select(unlist((violins %>% names)[order(violins %>% names)][1:36]), year) %>%
  gather(key = "metric", value = "value", -year) %>%
  ggplot(aes(x=year, y=value)) +
  geom_violin(aes(fill = year)) + 
  facet_wrap(~metric, scales = "free_y", ncol = 4) +
  theme(axis.text.y = element_text(size = 6), axis.text.x = element_text(angle = 90, hjust = 0.5, size = 6), 
        strip.text = element_text(size=6), aspect.ratio = 0.5) +
  guides(fill = FALSE) +
  labs(x = "", y = "")
```

```{r violinall2, fig.height=10, fig.cap = "Distribution of each socio-demographic variable across elections (part 2)."}
# Unscaled violin 2 plots go here
violins %>% 
  select(unlist((violins %>% names)[order(violins %>% names)][37:64])) %>%
  gather(key = "metric", value = "value", -year) %>%
  ggplot(aes(x=year, y=value)) +
  geom_violin(aes(fill = year)) + 
  facet_wrap(~metric, scales = "free_y", ncol = 4) +
  theme(axis.text.y = element_text(size = 6), axis.text.x = element_text(angle = 90, hjust = 0.5, size = 6), 
        strip.text = element_text(size=6), aspect.ratio = 0.5) +
  guides(fill = FALSE) +
  labs(x = "", y = "")
```




```{r scex, fig.cap = "Distribution of unscaled variables (including factors) excluded from the models.", include = FALSE}
# Standardized violin plots go here
data_mod %>% 
  select(-c((superset$varname %>% unlist), Election_Division, Swing, Perc_LNP)) %>% 
  gather(key = "metric", value = "value", -year) %>% 
  ggplot(aes(x=year, y=value)) +
  geom_violin(aes(fill = year)) + 
  facet_wrap(~metric, scales = "free", ncol = 6) +
  theme(axis.text.y = element_text(size = 6), axis.text.x = element_text(angle = 90, hjust = 0.5, size = 6), axis.title = element_text(size = 6), strip.text = element_text(size=5)) +
  guides(fill = FALSE) +
  labs(x = "", y = "")
```



# Model diagnostics {#diagnostics}

## Non-linearities: Residuals against predictors
```{r, out.width="100%", fig.cap = "Residuals vs. predictors in the model. No signs of non-linearity."}
aug_all %>%
  filter(year == "2016") %>% 
  gather(key = "variable", value = "value", -c(starts_with("."), Perc_LNP, year)) %>% 
  ggplot(aes(x = value, y = .resid)) +
  geom_point() + geom_smooth() + facet_wrap(~variable, scales = "free_x")
```

No obvious non-linearities in 2001, 2004, 2007, 2010, 2013, 2016.

## Residuals vs Predictors not in model
```{r, out.width="100%", fig.cap = "Residuals vs. predictors in the model. No clear ."}
vars_not_in <- names(data_mod)[which(!names(data_mod) %in% superset$varname)]

aug_all %>% bind_cols(data_mod %>% filter(!is.na(Perc_LNP))) %>% 
  filter(year == "2013") %>% 
  select(starts_with("."), c(vars_not_in), -c(Swing, year, Election_Division)) %>% 
  gather(key = "variable", value = "value", -c(starts_with("."), Perc_LNP)) %>%
  ggplot(aes(x = value, y = .resid)) +
  geom_point() + geom_smooth(level = 0.95) + facet_wrap(~variable, scales = "free")
```

No obvious patterns in the residuals vs omitted variables.


# Interpretation of more socio-demographics

This section contains the scatterplots and model visualizations that were omitted from the Insights section.

### Immigrants from the United Kingdom

Electorates with larger populations from the United Kingdom does not have a significant effect on two-party preference in any of the elections. From inspection of 

We expect greater populations from the UK to have a weakly positive relationship with support for the Liberal party (see figure \@ref(fig:rawUK)). The modelled effect is  Our model confirms this. BornUK is insignificant in every election. 

```{r rawUK, fig.cap="Scatterplot of population born in the United Kingdom against two-party preferred vote."}
## Voting against BornUK
data_mod %>% ggplot(aes(x = BornUK, y = Perc_LNP)) + geom_point(aes(label = Election_Division)) + geom_smooth(method = "lm") + facet_wrap(~year) + labs(x = "Population born in the United Kingdom", y = "Two-party preferred (%)")
```

```{r UK1, fig.cap="Estimated coefficients for population born in the United Kingdom across years with 95% confidence bands."}
# Coefficients
all_coefs %>% filter(term == "BornUK") %>% 
  ggplot(aes(x=year, y=estimate)) +
  geom_point(size = 3) + geom_linerange(aes(ymin = lower95, ymax = upper95), size = 1.5) + 
  geom_hline(aes(yintercept = 0), alpha = 0.5, size = 2) + 
  lims(y=c(-6.5,2.5)) +
  theme_bw() +
  theme(axis.text.x = element_text(size = 12), axis.text.y = element_text(size = 12), 
        axis.title = element_text(size = 12)) + 
  coord_fixed(0.15) + 
  labs(x = "", y = "Coefficient estimate: BornUK")
```

```{r UK2, out.width="100%"}
BornUK_01 <- visreg(fit_ss_01, "BornUK", gg = T, print.cond = FALSE) + 
  labs(x = "", y = "", title = "2001") +
  theme_bw() + 
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5)) +
  lims(x = c(-1.8, 5.2), y = c(32,68)) + coord_cartesian(expand = FALSE)
BornUK_04 <- visreg(fit_ss_04, "BornUK", gg = T, print.cond = FALSE) + 
  labs(x = "", y = "", title = "2004") +
  theme_bw() + 
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5)) +
  lims(x = c(-1.8, 5.2), y = c(32,68)) + coord_cartesian(expand = FALSE) 
BornUK_07 <- visreg(fit_ss_07, "BornUK", gg = T, print.cond = FALSE) + 
  labs(x = "", y = "", title = "2007") +
  theme_bw() + 
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5))  +
  lims(x = c(-1.8, 5.2), y = c(32,68)) + coord_cartesian(expand = FALSE)
BornUK_10 <- visreg(fit_ss_10, "BornUK", gg = T, print.cond = FALSE) + 
  labs(x = "", y = "", title = "2010") +
  theme_bw() + 
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5)) +
  lims(x = c(-1.8, 5.2), y = c(32,68)) + coord_cartesian(expand = FALSE) 
BornUK_13 <- visreg(fit_ss_13, "BornUK", gg = T, print.cond = FALSE) + 
  labs(x = "", y = "", title = "2013") +
  theme_bw() + 
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5)) +
  lims(x = c(-1.8, 5.2), y = c(32,68)) + coord_cartesian(expand = FALSE) 
BornUK_16 <- visreg(fit_ss_16, "BornUK", gg = T, print.cond = FALSE) + 
  labs(x = "", y = "", title = "2016") +
  theme_bw() + 
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5)) +
  lims(x = c(-1.8, 5.2), y = c(32,68)) + coord_cartesian(expand = FALSE) 

grid.arrange(BornUK_01, BornUK_04, BornUK_07, BornUK_10, BornUK_13, BornUK_16, 
             nrow = 2, 
             #top = textGrob("South-Eastern European Influence", gp = gpar(cex = 0.8)), 
             left = textGrob("Two-party preferred vote (%)", gp = gpar(cex = 0.8), rot = 90), 
             bottom = textGrob("Population born in the United Kingdom (relative)", gp = gpar(cex = 0.8)))
```

### Student population

```{r rawcurrstud, fig.cap="Scatterplot of population currently studying against two-party preferred vote."}
## Voting against CurrentlyStudying
data_mod %>% ggplot(aes(x = CurrentlyStudying, y = Perc_LNP)) + geom_point(aes(label = Election_Division)) + geom_smooth(method = "lm") + facet_wrap(~year) + labs(x = "Student population", y = "Two-party preferred (%)")
```

```{r currstud1, fig.cap="Estimated coefficients for student population across years with 95% confidence bands."}
# Coefficients
all_coefs %>% filter(term == "CurrentlyStudying") %>% 
  ggplot(aes(x=year, y=estimate)) +
  geom_point(size = 3) + geom_linerange(aes(ymin = lower95, ymax = upper95), size = 1.5) + 
  geom_hline(aes(yintercept = 0), alpha = 0.5, size = 2) + 
  lims(y=c(-8,8)) +
  theme_bw() +
  theme(axis.text.x = element_text(size = 12), axis.text.y = element_text(size = 12), 
        axis.title = element_text(size = 12)) + 
  coord_fixed(0.15) + 
  labs(x = "", y = "Coefficient estimate: CurrentlyStudying")
```

### Rental and Loan Payments

Rental prices and mortgage loan repayments do not appear to have a signficant relationship with party preference, based on the scatterplots. We find that in the 2010 election, higher median payment amounts had a highly positive relationship with support for the Liberal party. There is no obvious explanation for this, as housing affordability was not on the political agenda in the 2010 election.

```{r rawrentloan, fig.cap="Scatterplot of rental and loan payments against two-party preferred vote."}
## Voting against RentLoan
data_mod %>% ggplot(aes(x = RentLoan, y = Perc_LNP)) + geom_point(aes(label = Election_Division)) + geom_smooth(method = "lm") + facet_wrap(~year) + labs(x = "Rental and loan payments", y = "Two-party preferred (%)")
```

```{r rentloan1, fig.cap="Estimated coefficients for rental and loan payments across years with 95% confidence bands."}

# Coefficients
all_coefs %>% filter(term == "RentLoan") %>% 
  ggplot(aes(x=year, y=estimate)) +
  geom_point(size = 3) + geom_linerange(aes(ymin = lower95, ymax = upper95), size = 1.5) + 
  geom_hline(aes(yintercept = 0), alpha = 0.5, size = 2) + 
  lims(y=c(-8,8)) +
  theme_bw() +
  theme(axis.text.x = element_text(size = 12), axis.text.y = element_text(size = 12), 
        axis.title = element_text(size = 12)) + 
  coord_fixed(0.15) + 
  labs(x = "", y = "Coefficient estimate: RentLoan")
```

### Administrative Jobs and Education

Over all years we see that for moderate-to-high proportions of workers in administrative jobs, low education levels lead to support for the Liberal party. As we increase education, support increases for the Labor party. For at or below average proportions of administrative jobs, there is not as much of an education effect, as electorates for all education levels in this bracket would support Labor. 

```{r admineduc1, fig.cap="Modelled two-party preferred vote (fill) for combinations of education and administrative related jobs."}
admineduc_df <- data.frame(
  AdminJobs = rep(seq(-4,4, by = 0.01), times = 801),
  Education = rep(seq(-4,4, by = 0.01), each = 801),
  NoReligion = 0,
  CurrentlyStudying = 0,
  MedianAge = 0,
  OneParentHouse = 0,
  BornUK = 0,
  BornSEEurope = 0,
  ExtractiveJobs = 0,
  RentLoan = 0
)

admineduc_df$z16 = predict(fit_ss_16, admineduc_df) - fit_ss_16$coefficients[1]
admineduc_df$z13 = predict(fit_ss_13, admineduc_df) - fit_ss_13$coefficients[1]
admineduc_df$z10 = predict(fit_ss_10, admineduc_df) - fit_ss_10$coefficients[1]
admineduc_df$z07 = predict(fit_ss_07, admineduc_df) - fit_ss_07$coefficients[1]
admineduc_df$z04 = predict(fit_ss_04, admineduc_df) - fit_ss_04$coefficients[1]
admineduc_df$z01 = predict(fit_ss_01, admineduc_df) - fit_ss_01$coefficients[1]

Educ_Admin_16 <- admineduc_df %>% ggplot(aes(x=Education, y=AdminJobs)) +
  geom_raster(aes(fill = z16)) + 
  labs(x = "", y = "", fill = "Marginal effect on two-party preferred (%)", title = "2016") +
  theme_bw() + 
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5)) + geom_point(aes(x=Education,y=AdminJobs), data = data_mod %>% filter(year == "2016"), alpha = 0.5) +  
  scale_fill_gradientn(colours = c("#ff0000", "#ff6666", "#ff9999", "#ffcccc", "white", "#cce6ff", "#3399ff", "#3385ff", "#3366ff"), 
                       values = scales::rescale(c(min(admineduc_df$z16), -12, -6, -3, 
                                                  0, 3, 6, 12, max(admineduc_df$z16)))) +  
  guides(fill = FALSE) +
  lims(x = c(-1,3.6), y = c(-3.9, 3.0)) + coord_fixed(expand=FALSE, ratio = 4.6/6.9)

Educ_Admin_13 <- admineduc_df %>% ggplot(aes(x=Education, y=AdminJobs)) +
  geom_raster(aes(fill = z13)) + 
  labs(x = "", y = "", fill = "Marginal effect on two-party preferred (%)", title = "2013") +
  theme_bw() + 
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5)) + geom_point(aes(x=Education,y=AdminJobs), data = data_mod %>% filter(year == "2013"), alpha = 0.5) +  
  scale_fill_gradientn(colours = c("#ff0000", "#ff6666", "#ff9999", "#ffcccc", "white", "#cce6ff", "#3399ff", "#3385ff", "#3366ff"), 
                       values = scales::rescale(c(min(admineduc_df$z13), -12, -6, -3, 
                                                  0, 3, 6, 12, max(admineduc_df$z13)))) +  
  guides(fill = FALSE) +
  lims(x = c(-1,3.6), y = c(-3.9, 3.0)) + coord_fixed(expand=FALSE, ratio = 4.6/6.9)

Educ_Admin_10 <- admineduc_df %>% ggplot(aes(x=Education, y=AdminJobs)) +
  geom_raster(aes(fill = z10)) + 
  labs(x = "", y = "", fill = "Marginal effect on two-party preferred (%)", title = "2010") +
  theme_bw() + 
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5)) + geom_point(aes(x=Education,y=AdminJobs), data = data_mod %>% filter(year == "2010"), alpha = 0.5) +  
  scale_fill_gradientn(colours = c("#ff0000", "#ff6666", "#ff9999", "#ffcccc", "white", "#cce6ff", "#3399ff", "#3385ff", "#3366ff"), 
                       values = scales::rescale(c(min(admineduc_df$z10), -12, -6, -3, 
                                                  0, 3, 6, 12, max(admineduc_df$z10)))) +  
  guides(fill = FALSE) +
  lims(x = c(-1,3.6), y = c(-3.9, 3.0)) + coord_fixed(expand=FALSE, ratio = 4.6/6.9)

Educ_Admin_07 <- admineduc_df %>% ggplot(aes(x=Education, y=AdminJobs)) +
  geom_raster(aes(fill = z07)) + 
  labs(x = "", y = "", fill = "Marginal effect on two-party preferred (%)", title = "2007") +
  theme_bw() + 
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5)) + geom_point(aes(x=Education,y=AdminJobs), data = data_mod %>% filter(year == "2007"), alpha = 0.5) +  
  scale_fill_gradientn(colours = c("#ff0000", "#ff6666", "#ff9999", "#ffcccc", "white", "#cce6ff", "#3399ff", "#3385ff", "#3366ff"), 
                       values = scales::rescale(c(min(admineduc_df$z07), -12, -6, -3, 
                                                  0, 3, 6, 12, max(admineduc_df$z07)))) +  
  guides(fill = FALSE) +
  lims(x = c(-1,3.6), y = c(-3.9, 3.0)) + coord_fixed(expand=FALSE, ratio = 4.6/6.9)

Educ_Admin_04 <- admineduc_df %>% ggplot(aes(x=Education, y=AdminJobs)) +
  geom_raster(aes(fill = z04)) + 
  labs(x = "", y = "", fill = "Marginal effect on two-party preferred (%)", title = "2004") +
  theme_bw() + 
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5)) + geom_point(aes(x=Education,y=AdminJobs), data = data_mod %>% filter(year == "2004"), alpha = 0.5) +  
  scale_fill_gradientn(colours = c("#ff0000", "#ff6666", "#ff9999", "#ffcccc", "white", "#cce6ff", "#3399ff", "#3385ff", "#3366ff"), 
                       values = scales::rescale(c(min(admineduc_df$z04), -12, -6, -3, 
                                                  0, 3, 6, 12, max(admineduc_df$z04)))) +  
  guides(fill = FALSE) +
  lims(x = c(-1,3.6), y = c(-3.9, 3.0)) + coord_fixed(expand=FALSE, ratio = 4.6/6.9)

Educ_Admin_01 <- admineduc_df %>% ggplot(aes(x=Education, y=AdminJobs)) +
  geom_raster(aes(fill = z01)) + 
  labs(x = "", y = "", fill = "Marginal effect on two-party preferred (%)", title = "2001") +
  theme_bw() + 
  theme(plot.title = element_text(face = "bold", size = 10, hjust = 0.5)) + geom_point(aes(x=Education,y=AdminJobs), data = data_mod %>% filter(year == "2001"), alpha = 0.5) +  
  scale_fill_gradientn(colours = c("#ff0000", "#ff6666", "#ff9999", "#ffcccc", "white", "#cce6ff", "#3399ff", "#3385ff", "#3366ff"), 
                       values = scales::rescale(c(min(admineduc_df$z01), -12, -6, -3, 
                                                  0, 3, 6, 12, max(admineduc_df$z01)))) +  
  guides(fill = FALSE) +
  lims(x = c(-1,3.6), y = c(-3.9, 3.0)) + coord_fixed(expand=FALSE, ratio = 4.6/6.9)

grid.arrange(Educ_Admin_01, Educ_Admin_04, Educ_Admin_07, Educ_Admin_10, Educ_Admin_13, Educ_Admin_16, 
             nrow = 2, 
             bottom = textGrob("Education level", gp = gpar(cex = 0.8)), 
             left = textGrob("Administrative jobs", gp = gpar(cex = 0.8), rot = 90))

```

```{r admineducscale, out.width="50%"}
## TPP scale
TPP_scale <- readPNG("figures/TPP_scale.png")
 grid.raster(TPP_scale)
```

# Why choose all five variable linear models?

For each election, we compute all possible five variable linear models as a model set from which Akaike weights will be computed. *Five* variables models are a compromise between computational burden and capturing sufficient information in the model set. 

Because we can't run linear models for all possible combinations of our predictors, we use an iterative procedure to fit 20 models for each number of predictors. This means 20 models with 2 variables, 20 models with 3 variables and so on. The process is as follows:

1. Fit all possible 2 variable models.

2. Retain the 10 models with highest R-squared, and another 10 models selected at random.

3. Fit all possible three variable models to each of these 20 two-variable models, by adding one variable. This means for every retained model, there will be $30 - 2 = 28$ models fit.

4. Repeat steps 2 and 3 for the 3 variable models, 4 variable models, and so on, until reaching a model with all 30 variables.

Figure \@ref(fig:tradeoff) shows the R-squared for each of the models retained, with the number of predictors on the x-axis, and R-squared on the y-axis. The line represents the maximum R-squared each number of predictors. We see that around 70% of variation in two-party preference can be explained by a five variable model in each election, and the full variable set explains around 80% of variation (i.e. R-squared of 0.8%). We see that from variable 4 onwards, there is little incremental gain in R-squared from adding another variable.

All possible $p$ variable models for each election involves fitting ${30 \choose p} \times 6$ models. The computational burden here becomes huge very quickly. For this reason, we have chosen $p=5$ variable models, as it is computationally feasible and we still will capture models that have high R-squared.

```{r tradeoff, fig.cap = "Estimates of R-squared against number of variables included in a linear model."}
load("../Modelling-Elections/Clean-Data/step_all.rda")

ggplot(aes(x = num_vars, y = r2), data = step_all) + 
  geom_point(alpha = 0.3) +
  geom_line(data = step_all %>% filter(max_r2 == 1)) +
  facet_wrap(~year) +
  labs(x = "Number of variables", y = "R-squared")
```

As seen in figure \@ref(fig:tradeoff), around 70% of variation in two-party preference can be explained by a five variable model in each election, and incremental gains from increasing the number of predictors is decreasing (see appendix G for a full description of this process).

## Resultant Akaike weights

```{r allSAW, fig.cap = "Sum of Akaike weights for each variable, in each election.", results = 'asis'}
load("../Modelling-Elections/Clean-Data/var_imp_all.rda")

tab_aw <- var_imp_all %>% 
  select(varname, year, sum_w) %>% 
  spread("year", "sum_w") %>% 
  rename(Variable = varname) %>% 
  xtable::xtable(caption = "Sum of Akaike weights for each variable, in each election.")

print(tab_aw, comment = FALSE, include.rownames = FALSE)
```

# Omitted variables

We linearly regress each omitted variable against the superset of predictors, and record the R-squared values in each election.

```{r ovb, fig.cap = "R-squared of each omitted variable when regressed on the superset each year."}
OVB_fn <- function(Year) {
  Year <- as.character(Year)
  
OVB_lm <- data.frame(varname = names(data_mod), r2 = 0, adj_r2 = 0) %>% 
  filter(!varname %in% c("Election_Division", "Perc_LNP", "Swing", "year", superset$varname %>% unlist %>% as.character))

for (i in 1:nrow(OVB_lm)) {
  varname = OVB_lm$varname[i] %>% as.character()
  data_ovb = data_mod %>% filter(year == Year, !is.na(Perc_LNP)) %>% select(c(superset$varname %>% as.character), varname)
  formula_ovb = paste0(varname, " ~ .")
  lmod = lm(formula = formula_ovb,
            data = data_ovb)
  OVB_lm$r2[i] = summary(lmod)$r.squared
  OVB_lm$adj_r2[i] = summary(lmod)$adj.r.squared
}

OVB_lm <- OVB_lm %>% mutate(year = Year)

return(OVB_lm)
}

OVB_all <- bind_rows(OVB_fn(2001), OVB_fn(2004), OVB_fn(2007), OVB_fn(2010), OVB_fn(2013), OVB_fn(2016)) %>% 
  select(-adj_r2)

OVB_all %>% 
  ggplot(aes(x=r2, y = reorder(varname, r2))) + 
  geom_point(aes(col = year), size = 2) +
  labs(x = "R-squared", y = "Omitted Variable") 

# Order by average in each row
# Discuss those above 75%
# Others:

# Argue - avoided OVB by construction
# Then discuss why some variables are omitted
```

# Principal components

Loadings in the 2nd, 3rd and 4th principal components for each election.

```{r loadings2, fig.cap = "Loadings of each variable in the second principal of each election year (points), with a line showing the range across years."}
vis_loadings %>% 
  ggplot(aes(x=reorder(metric,-PC2), y=PC2)) + geom_line(col = "orange", size = 2, alpha = 0.7) +
  geom_point(size = 1, alpha = 1) + 
  theme(axis.text.x = element_text(angle = 60, hjust=1, size = 6)) +
  labs(x = "Socio-demographic variable", y = "Loading in first principal component")

```

```{r loadings3, fig.cap = "Loadings of each variable in the third principal of each election year (points), with a line showing the range across years."}
vis_loadings %>% 
  ggplot(aes(x=reorder(metric,-PC3), y=PC3)) + geom_line(col = "purple", size = 2, alpha = 0.4) +
  geom_point(size = 1, alpha = 1) + 
  theme(axis.text.x = element_text(angle = 60, hjust=1, size = 6)) +
  labs(x = "Socio-demographic variable", y = "Loading in first principal component")
```

```{r loadings4, fig.cap = "Loadings of each variable in the fourth principal of each election year (points), with a line showing the range across years."}
vis_loadings %>% 
  ggplot(aes(x=reorder(metric,-PC4), y=PC4)) + geom_line(col = "dark green", size = 2, alpha = 0.5) +
  geom_point(size = 1, alpha = 1) + 
  theme(axis.text.x = element_text(angle = 60, hjust=1, size = 6)) +
  labs(x = "Socio-demographic variable", y = "Loading in first principal component")
```



